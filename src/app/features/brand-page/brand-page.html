<app-header></app-header>
<section class="bg-background text-text-primary">

  @if (mode === 'group') {

    <!-- ── GROUP MODE ─────────────────────────────────────────────── -->

    <div class="mx-auto w-full pt-6">
      <div class="relative overflow-hidden bg-secondary shadow-soft">
        @if (loading) {
          <div class="w-full h-[180px] sm:h-[240px] md:h-[320px] lg:h-[360px] skeleton"></div>
        } @else {
          <img [src]="brandHeroUrl" [alt]="brand?.name ?? 'Brand hero'"
            class="w-full h-[180px] sm:h-[240px] md:h-[320px] lg:h-[360px] object-cover object-center" loading="lazy"/>
        }
      </div>
    </div>

    <div class="mx-auto w-full max-w-[1440px] px-4 sm:px-6 lg:px-10">

      <div class="pt-12 sm:pt-14 lg:pt-16 flex flex-col items-center gap-8 sm:gap-10">
        <p class="text-center text-text-primary text-sm sm:text-base font-semibold uppercase tracking-wide-luxury animate-fade-in-up">
          About this Brand
        </p>

        <div class="w-[240px] sm:w-[280px] h-[110px] sm:h-[130px] lg:w-[320px] lg:h-[150px] flex items-center justify-center animate-scale-in delay-100">
          @if (loading) {
            <div class="skeleton w-full h-full rounded-xl"></div>
          } @else {
            <img *ngIf="brand?.logoUrl; else fallbackLogoGroup" [src]="brand!.logoUrl" [alt]="brand?.name ?? 'Brand logo'" class="max-w-full max-h-full object-contain" loading="lazy"/>
            <ng-template #fallbackLogoGroup><div class="w-full h-full rounded-xl bg-primary"></div></ng-template>
          }
        </div>

        @if (loading) {
          <div class="w-full max-w-2xl flex flex-col items-center gap-2 px-2">
            <div class="skeleton h-4 w-3/4 rounded"></div>
            <div class="skeleton h-4 w-5/6 rounded"></div>
            <div class="skeleton h-4 w-2/3 rounded"></div>
          </div>
        } @else {
          <p class="max-w-2xl text-center text-text-secondary text-sm sm:text-base leading-6 tracking-tight px-2 animate-fade-in-up delay-200">
            {{ brand?.description }}
          </p>
        }
      </div>

      <div class="pt-12 sm:pt-14 lg:pt-16 pb-16 animate-fade-in-up delay-300">
        <div class="px-1 mb-6">
          <span class="text-text-primary text-base sm:text-lg font-semibold tracking-[0.24em]">COLLECTIONS</span>
        </div>

        @if (loading) {
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (i of [1,2,3]; track i) {
              <div class="rounded-2xl overflow-hidden bg-secondary shadow-soft">
                <div class="skeleton w-full aspect-[4/3]"></div>
                <div class="px-6 py-5 flex items-center justify-between gap-4">
                  <div class="skeleton h-4 w-32 rounded"></div>
                  <div class="skeleton h-4 w-4 rounded-full shrink-0"></div>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
            @for (entry of collectionEntries; track entry.handle) {
              <a [routerLink]="['/shop/brand', entry.handle]"
                class="group block rounded-2xl overflow-hidden bg-secondary shadow-soft hover:shadow-luxury transition-shadow duration-300">
                <div class="relative w-full aspect-[4/3] bg-background overflow-hidden">
                  <img *ngIf="entry.imageUrl; else collectionPlaceholder" [src]="entry.imageUrl" [alt]="entry.title"
                    class="absolute inset-0 w-full h-full object-cover object-center transition-transform duration-500 group-hover:scale-[1.03]" loading="lazy"/>
                  <ng-template #collectionPlaceholder>
                    <div class="absolute inset-0 bg-primary/10 flex items-center justify-center">
                      <span class="text-text-muted text-sm">{{ entry.title }}</span>
                    </div>
                  </ng-template>
                  <div class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/5"></div>
                </div>
                <div class="px-6 py-5 flex items-center justify-between">
                  <p class="text-text-primary text-sm sm:text-base font-semibold tracking-[0.18em] uppercase">{{ entry.title }}</p>
                  <svg class="w-4 h-4 text-text-muted group-hover:text-text-primary transition-colors duration-300 shrink-0 ml-3" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M9 5l7 7-7 7"/>
                  </svg>
                </div>
              </a>
            }
          </div>
        }
      </div>
    </div>

  } @else if (notFound) {

    <!-- ── NOT FOUND STATE (no hero, no filters, nothing else) ─────── -->

    <div class="mx-auto w-full max-w-[1440px] px-4 sm:px-6 lg:px-10">
      <div class="py-32 sm:my-44 flex flex-col items-center text-center px-4 animate-fade-in-up">
        <div class="relative mb-10 flex items-center justify-center">
          <svg class="absolute w-28 h-28 opacity-10 animate-spin" style="animation-duration:18s" viewBox="0 0 112 112" fill="none">
            <circle cx="56" cy="56" r="54" stroke="currentColor" stroke-width="1" stroke-dasharray="6 6" class="text-text-primary"/>
          </svg>
          <svg class="w-10 h-10 text-text-muted" viewBox="0 0 40 40" fill="none">
            <path d="M20 4 L36 20 L20 36 L4 20 Z" stroke="currentColor" stroke-width="1" fill="none"/>
            <line x1="20" y1="4" x2="20" y2="36" stroke="currentColor" stroke-width="0.5" opacity="0.4"/>
            <line x1="4" y1="20" x2="36" y2="20" stroke="currentColor" stroke-width="0.5" opacity="0.4"/>
            <circle cx="20" cy="20" r="1.5" fill="currentColor" opacity="0.6"/>
          </svg>
        </div>
        <p class="text-xs font-semibold uppercase tracking-[0.3em] text-text-muted mb-5">Collection Unavailable</p>
        <h2 class="text-3xl sm:text-4xl font-normal text-text-primary mb-5 leading-snug"
          style="font-family:'Playfair Display',ui-serif,Georgia,serif">
          Nothing to show<br class="hidden sm:block"/> right now
        </h2>
        <div class="w-12 h-px bg-border mb-5"></div>
        <p class="text-text-secondary max-w-xs sm:max-w-sm text-sm leading-6 mb-10">
          This collection may have moved or been temporarily removed. Explore our other brands in the meantime.
        </p>
        <button type="button" (click)="goBack()"
          class="group inline-flex items-center gap-2.5 px-8 py-3 text-xs font-semibold uppercase tracking-[0.22em] text-text-primary transition-all duration-300 outline outline-1 outline-offset-[-1px] outline-primary hover:bg-primary hover:text-white">
          <svg class="w-3.5 h-3.5 transition-transform duration-300 group-hover:-translate-x-0.5" viewBox="0 0 14 14" fill="none">
            <path d="M13 7H1M1 7L7 1M1 7L7 13" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          Go Back
        </button>
      </div>
    </div>

  } @else {

    <!-- ── SINGLE COLLECTION ───────────────────────────────────────── -->

    <!-- HERO -->
    <div class="mx-auto w-full pt-6">
      <div class="relative overflow-hidden bg-secondary shadow-soft">
        @if (loading) {
          <div class="w-full h-[180px] sm:h-[240px] md:h-[320px] lg:h-[360px] skeleton"></div>
        } @else {
          <img [src]="brandHeroUrl" [alt]="brand?.name ?? 'Brand hero'"
            class="w-full h-[180px] sm:h-[240px] md:h-[320px] lg:h-[360px] object-cover object-center" loading="lazy"/>
        }
      </div>
    </div>

    <div class="mx-auto w-full max-w-[1440px] px-4 sm:px-6 lg:px-10">

      <!-- ABOUT THIS BRAND (top) -->
      <div class="pt-12 sm:pt-14 lg:pt-16 flex flex-col items-center gap-8 sm:gap-10">
        <p class="text-center text-text-primary text-sm sm:text-base font-semibold uppercase tracking-wide-luxury animate-fade-in-up">
          About this Brand
        </p>

        <div class="w-[240px] sm:w-[280px] h-[110px] sm:h-[130px] lg:w-[320px] lg:h-[150px] flex items-center justify-center animate-scale-in delay-100">
          @if (loading) {
            <div class="skeleton w-full h-full rounded-xl"></div>
          } @else {
            <img *ngIf="brand?.logoUrl; else fallbackLogo" [src]="brand!.logoUrl" [alt]="brand?.name ?? 'Brand logo'" class="max-w-full max-h-full object-contain" loading="lazy"/>
            <ng-template #fallbackLogo><div class="w-full h-full rounded-xl bg-primary"></div></ng-template>
          }
        </div>

        @if (loading) {
          <div class="w-full max-w-2xl flex flex-col items-center gap-2 px-2">
            <div class="skeleton h-4 w-4/5 rounded"></div>
            <div class="skeleton h-4 w-3/4 rounded"></div>
            <div class="skeleton h-4 w-2/3 rounded"></div>
          </div>
        } @else {
          <p class="max-w-2xl text-center text-text-secondary text-sm sm:text-base leading-6 tracking-tight px-2 animate-fade-in-up delay-200">
            {{ brand?.description }}
          </p>
        }
      </div>

      <!-- SHOP + FILTERS -->
      <div class="pt-12 sm:pt-14 lg:pt-16 animate-fade-in-up delay-300">
        <div class="flex flex-col gap-4">
          <div class="px-1">
            <span class="text-text-primary text-base sm:text-lg font-semibold tracking-[0.24em]">SHOP</span>
          </div>

          @if (loading) {
            <div class="flex flex-wrap gap-3 sm:gap-4">
              @for (i of [1,2,3,4]; track i) {
                <div class="skeleton h-[46px] sm:h-[56px] w-20 sm:w-32 rounded"></div>
              }
            </div>
          } @else {
            <div class="flex flex-wrap gap-3 sm:gap-4">
              @for (c of categories; track c.key) {
                <button type="button" (click)="selectCategory(c.key)"
                  class="px-5 py-3 sm:py-4 outline outline-2 outline-offset-[-2px] outline-primary text-xs sm:text-sm md:text-base font-semibold tracking-[0.22em] transition-all duration-300 hover:bg-primary hover:text-white"
                  [class.bg-primary]="selectedCategory === c.key"
                  [class.text-white]="selectedCategory === c.key"
                  [class.bg-transparent]="selectedCategory !== c.key"
                  [class.text-text-primary]="selectedCategory !== c.key">
                  {{ c.label }}
                </button>
              }
            </div>
          }
        </div>
      </div>

      <!-- PRODUCTS GRID -->
      <div class="pt-10 sm:pt-12 pb-12">
        @if (loading) {
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8 sm:gap-x-6 sm:gap-y-10">
            @for (i of [1,2,3,4,5,6,7,8]; track i) {
              <div>
                <div class="skeleton w-full aspect-[3/4] rounded-xl"></div>
                <div class="pt-4 flex flex-col gap-2">
                  <div class="skeleton h-3 w-16 rounded"></div>
                  <div class="skeleton h-4 w-full rounded"></div>
                  <div class="skeleton h-4 w-14 rounded"></div>
                </div>
              </div>
            }
          </div>
        } @else {
          <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-x-4 gap-y-8 sm:gap-x-6 sm:gap-y-10">
            @for (p of visibleProducts; track p.id) {
              <a class="group block" [routerLink]="['/product', p.id]">
                <div class="bg-secondary rounded-xl overflow-hidden shadow-soft transition-shadow duration-300 hover:shadow-luxury">
                  <div class="relative w-full aspect-[3/4] bg-background overflow-hidden">
                    <img [src]="p.imageUrl" [alt]="p.title"
                      class="absolute inset-0 w-full h-full object-contain p-6 transition-transform duration-500 group-hover:scale-[1.03]" loading="lazy"/>
                    <div class="pointer-events-none absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-black/5"></div>
                  </div>
                </div>
                <div class="pt-4">
                  <p class="text-text-muted text-xs sm:text-sm leading-5">{{ brand?.name ?? p.vendor }}</p>
                  <p class="text-text-primary text-sm sm:text-base leading-6">{{ p.title }}</p>
                  <p class="text-text-primary text-sm sm:text-base font-bold leading-6">{{ p.price }}</p>
                </div>
              </a>
            }
          </div>

          <div class="pt-12 flex justify-center">
            @if (canLoadMore) {
              <button type="button" (click)="loadMore()"
                class="px-6 py-2.5 rounded-xl outline outline-1 outline-offset-[-1px] outline-primary text-text-primary text-sm sm:text-base font-medium transition-all duration-300 hover:bg-primary hover:text-white">
                See More
              </button>
            }
          </div>
        }
      </div>

      <!-- DIVIDER -->
      <div class="border-t border-border"></div>

      <!-- ABOUT THIS BRAND (bottom) + WHY WE LOVE -->
      <div class="py-14 sm:py-16 lg:py-20">
        <p class="text-center text-text-primary text-sm sm:text-base font-semibold uppercase tracking-wide-luxury mb-8 sm:mb-10 animate-fade-in-up">
          About this Brand
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 lg:gap-10 items-center">

          <div class="lg:col-span-7 animate-fade-in-left">
            <div class="overflow-hidden rounded-2xl bg-secondary shadow-soft">
              @if (loading) {
                <div class="skeleton w-full h-[320px] sm:h-[420px] lg:h-[560px]"></div>
              } @else {
                <img [src]="brandAboutImageUrl" [alt]="brand?.name ?? 'Brand image'"
                  class="w-full h-[320px] sm:h-[420px] lg:h-[560px] object-cover object-center" loading="lazy"/>
              }
            </div>
          </div>

          <div class="lg:col-span-5 animate-fade-in-right">
            <div class="bg-secondary rounded-2xl p-8 sm:p-10 shadow-soft hover:shadow-luxury transition-shadow duration-300">
              <h3 class="text-text-primary text-2xl sm:text-3xl font-normal tracking-wider leading-10"
                style="font-family:'Playfair Display',ui-serif,Georgia,serif">
                Why We Love
              </h3>

              <div class="mt-8 w-[220px] sm:w-[260px] h-[90px] sm:h-[120px] flex items-center justify-start">
                @if (loading) {
                  <div class="skeleton w-full h-full rounded-xl"></div>
                } @else {
                  <img *ngIf="brand?.logoUrl; else fallbackLogo2" [src]="brand!.logoUrl" [alt]="brand?.name ?? 'Brand logo'" class="max-w-full max-h-full object-contain" loading="lazy"/>
                  <ng-template #fallbackLogo2><div class="w-full h-full rounded-xl bg-primary"></div></ng-template>
                }
              </div>

              @if (loading) {
                <div class="mt-8 flex flex-col gap-2">
                  <div class="skeleton h-4 w-full rounded"></div>
                  <div class="skeleton h-4 w-5/6 rounded"></div>
                  <div class="skeleton h-4 w-4/6 rounded"></div>
                  <div class="skeleton h-4 w-3/4 rounded mt-2"></div>
                  <div class="skeleton h-4 w-2/3 rounded"></div>
                </div>
              } @else {
                <p class="mt-8 text-text-secondary text-sm sm:text-base leading-6 tracking-tight whitespace-pre-line">
                  {{ whyWeLoveText }}
                </p>
              }

              <div class="mt-10">
                @if (loading) {
                  <div class="skeleton h-8 w-28 rounded"></div>
                } @else if (signatureUrl) {
                  <img [src]="signatureUrl" alt="Signature" class="w-28 sm:w-32 h-auto object-contain" loading="lazy"/>
                }
              </div>
            </div>
          </div>

        </div>
      </div>

    </div>
  }

</section>
<app-footer></app-footer>
